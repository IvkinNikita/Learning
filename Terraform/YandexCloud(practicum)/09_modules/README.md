# Terraform: ะะพะดัะปะธ โ ะฟะตัะตะธัะฟะพะปัะทัะตะผะฐั ะธะฝััะฐััััะบัััะฐ

ะะพะดัะปะธ ะฒ Terraform โ ััะพ ัะฟะพัะพะฑ ัะฟะฐะบะพะฒะฐัั ะฟะพะฒัะพัััััััั ะธะฝััะฐััััะบัััะฝัั ะปะพะณะธะบั (ัะตััััั, ะฟะตัะตะผะตะฝะฝัะต, ะฒััะพะดั) ะฒ **ะตะดะธะฝัะน ะฟะตัะตะธัะฟะพะปัะทัะตะผัะน ะฑะปะพะบ**.  
ะะฝะธ ัะผะตะฝััะฐัั ะดัะฑะปะธัะพะฒะฐะฝะธะต, ัะฟัะพัะฐัั ะฟะพะดะดะตัะถะบั ะธ ะดะตะปะฐัั ะบะพะด ัะธัะต.

---

## ๐งฑ ะงัะพ ัะฐะบะพะต ะผะพะดัะปั?

ะะพะดัะปั โ ััะพ **ะฟะฐะฟะบะฐ ั ัะฐะนะปะฐะผะธ `.tf`**, ัะพะดะตัะถะฐัะฐั:
- ะะตััััั (`resource`)
- ะัะพะดะฝัะต ะฟะตัะตะผะตะฝะฝัะต (`variable`)
- ะััะพะดะฝัะต ะทะฝะฐัะตะฝะธั (`output`)
- ะะฟัะธะพะฝะฐะปัะฝะพ: `versions.tf`, `providers.tf`, `locals`, etc.

ะะฐะถะต ะบะพัะฝะตะฒะพะน ะฟัะพะตะบั โ ััะพ ะผะพะดัะปั. ะะพ **ะฒะฝะตัะฝะธะต ะผะพะดัะปะธ** ะฟะพะดะบะปััะฐัััั ัะฒะฝะพ ัะตัะตะท ะฑะปะพะบ `module`.

---

## ๐ฆ ะัะธะผะตั: ะฟัะพััะพะน ะผะพะดัะปั

ะกัััะบัััะฐ:
```
modules/
โโโ vpc/
    โโโ main.tf
    โโโ variables.tf
    โโโ outputs.tf
```

`modules/vpc/variables.tf`:
```hcl
variable "vpc_name" {
  type = string
}

variable "cidr_block" {
  type = string
}
```

`modules/vpc/main.tf`:
```hcl
resource "yandex_vpc_network" "this" {
  name = var.vpc_name
}

resource "yandex_vpc_subnet" "this" {
  name       = "${var.vpc_name}-subnet"
  network_id = yandex_vpc_network.this.id
  v4_cidr_blocks = [var.cidr_block]
}
```

`modules/vpc/outputs.tf`:
```hcl
output "vpc_id" {
  value = yandex_vpc_network.this.id
}

output "subnet_id" {
  value = yandex_vpc_subnet.this.id
}
```

---

## ๐ ะะฐะบ ะธัะฟะพะปัะทะพะฒะฐัั ะผะพะดัะปั

ะ ะบะพัะฝะตะฒะพะผ `main.tf`:
```hcl
module "prod_vpc" {
  source = "./modules/vpc"

  vpc_name    = "prod-vpc"
  cidr_block  = "10.0.1.0/24"
}

# ะัะฟะพะปัะทะพะฒะฐัั ะฒััะพะดั
resource "yandex_compute_instance" "vm" {
  subnet_id = module.prod_vpc.subnet_id
  # ...
}
```

ะะพัะปะต ะดะพะฑะฐะฒะปะตะฝะธั ะผะพะดัะปั โ ะฒัะฟะพะปะฝะธัั:
```bash
terraform init
```
Terraform ัะบะฐัะฐะตั (ะธะปะธ ัะบะพะฟะธััะตั ะปะพะบะฐะปัะฝะพ) ะผะพะดัะปั ะธ ะฟะพะดะณะพัะพะฒะธั ะตะณะพ ะบ ะธัะฟะพะปัะทะพะฒะฐะฝะธั.

---

## ๐ ะขะธะฟั ะธััะพัะฝะธะบะพะฒ ะผะพะดัะปะตะน

| ะััะพัะฝะธะบ               | ะัะธะผะตั                               |
|------------------------|--------------------------------------|
| ะะพะบะฐะปัะฝะฐั ะฟะฐะฟะบะฐ        | `source = "./modules/vpc"`           |
| Git-ัะตะฟะพะทะธัะพัะธะน        | `source = "git::https://github.com/org/infra-modules.git//vpc"` |
| Terraform Registry     | `source = "terraform-aws-modules/vpc/aws"` |
| Yandex Cloud Registry* | (ะฟะพะบะฐ ะฝะตั ะพัะธัะธะฐะปัะฝะพะณะพ, ะธัะฟะพะปัะทัะน Git) |

> ๐ก ะกะพะฒะตั: ะดะปั ะฒะฝัััะตะฝะฝะธั ะฟัะพะตะบัะพะฒ ััะฐะฝะธัะต ะผะพะดัะปะธ ะฒ ะฟัะธะฒะฐัะฝะพะผ Git-ัะตะฟะพะทะธัะพัะธะธ ั ัะตะณะฐะผะธ (`v1.0.0`).

---

## โ ะัััะธะต ะฟัะฐะบัะธะบะธ

- **ะะผะตะฝัะนัะต ะผะพะดัะปะธ ะฟะพ ะพัะฒะตัััะฒะตะฝะฝะพััะธ**: `vpc`, `k8s-cluster`, `s3-bucket`.
- **ะะต ะดะตะปะฐะนัะต "ัะฝะธะฒะตััะฐะปัะฝัะต" ะผะพะดัะปะธ** โ ะปัััะต ะฝะตัะบะพะปัะบะพ ัะทะบะพัะฟะตัะธะฐะปะธะทะธัะพะฒะฐะฝะฝัั.
- **ะัะตะณะดะฐ ะพะฟัะตะดะตะปัะนัะต `variable` ะธ `output`** โ ััะพ ะธะฝัะตััะตะนั ะผะพะดัะปั.
- **ะฃะบะฐะทัะฒะฐะนัะต ะฒะตััะธะธ ะฟัะพะฒะฐะนะดะตัะพะฒ** ะฒ ะผะพะดัะปะต (`required_providers` ะฒ `versions.tf`).
- **ะขะตััะธััะนัะต ะผะพะดัะปะธ** ะพัะดะตะปัะฝะพ (ะฝะฐะฟัะธะผะตั, ัะตัะตะท `terratest` ะธะปะธ ัััะฝัะต `apply` ะฒ ะธะทะพะปะธัะพะฒะฐะฝะฝะพะผ ะฐะบะบะฐัะฝัะต).

---

## ๐ ะะฐัะฟัะพัััะฐะฝัะฝะฝัะต ะพัะธะฑะบะธ

- โ ะฅะฐัะดะบะพะด ะทะฝะฐัะตะฝะธะน ะฒะฝัััะธ ะผะพะดัะปั (ะฒัั โ ัะตัะตะท `variable`).
- โ ะะตัะตะดะฐัะฐ ัะตะปะพะณะพ `map` ะฒะผะตััะพ ะบะพะฝะบัะตัะฝัั ะฟะฐัะฐะผะตััะพะฒ (ะฝะฐัััะฐะตั ัะธัะฐะตะผะพััั).
- โ ะัะฟะพะปัะทะพะฒะฐะฝะธะต ะผะพะดัะปั ะฑะตะท `terraform init` ะฟะพัะปะต ะธะทะผะตะฝะตะฝะธั `source`.

---

## ๐ ะะพะปะตะทะฝัะต ัััะปะบะธ

- [ะัะธัะธะฐะปัะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั ะฟะพ ะผะพะดัะปัะผ](https://developer.hashicorp.com/terraform/language/modules)
- [Terraform Module Registry](https://registry.terraform.io/)
- [Yandex Cloud Provider Docs](https://registry.terraform.io/providers/yandex-cloud/yandex/latest)

> ๐ก ะะปั ะฟัะพะตะบัะพะฒ ะฒ Yandex Cloud: ะฟะธัะธัะต ัะพะฑััะฒะตะฝะฝัะต ะผะพะดัะปะธ ะฟะพะด ัะธะฟะพะฒัะต ะฟะฐััะตัะฝั (ะฝะฐะฟัะธะผะตั, ยซVPC + NAT + security groupsยป) โ ััะพ ัะธะปัะฝะพ ััะบะพัะธั ัะฐะทะฒััััะฒะฐะฝะธะต ะฝะพะฒัั ััะตะด.