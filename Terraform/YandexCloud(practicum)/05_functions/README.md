## Функции в Terraform

Функции в Terraform — это встроенные утилиты, которые позволяют выполнять преобразования и вычисления над значениями в конфигурационных файлах (`.tf`). Они активно используются в выражениях для работы со строками, числами, списками, картами (maps), объектами и другими типами данных, поддерживаемыми языком конфигурации HCL (HashiCorp Configuration Language).

### Основные возможности

- **Манипуляции с данными**: например, объединение строк (`join`), преобразование регистра (`lower`, `upper`), извлечение подстрок (`substr`).
- **Работа с коллекциями**: сортировка (`sort`), фильтрация (`distinct`), преобразование (`map`, `flatten`), объединение (`merge`, `concat`).
- **Математические операции**: округление (`floor`, `ceil`), генерация случайных значений (`random`), арифметические вычисления.
- **Работа с файлами и путями**: чтение содержимого (`file`), обработка шаблонов (`templatefile`), работа с путями (`basename`, `dirname`).
- **Конвертация типов**: приведение к строке (`tostring`), числу (`tonumber`), логическому значению (`tobool`) и т.д.

### Примеры использования

```hcl
# Преобразование имени в нижний регистр
name = lower(var.project_name)

# Объединение тегов
tags = merge(var.common_tags, { Environment = var.env })

# Генерация списка зон доступности
availability_zones = slice(var.all_zones, 0, var.instance_count)

# Чтение содержимого файла
user_data = templatefile("${path.module}/scripts/init.sh", {
  hostname = var.hostname
})
```

### Важные особенности

- **Нельзя определять собственные функции** в HCL. Однако логику можно инкапсулировать с помощью:
  - **Локальных значений** (`locals`) — для повторного использования выражений внутри модуля.
  - **Модулей** — для повторного использования конфигурации между проектами.
- Все функции вычисляются **на этапе планирования** (`terraform plan`), поэтому они не могут зависеть от состояния, которое появится только после применения (`apply`), если не используются `null`-значения и `depends_on` явно.
- Список всех доступных функций и их описание можно найти в [официальной документации Terraform](https://developer.hashicorp.com/terraform/language/functions).

Функции значительно упрощают написание гибких, читаемых и переиспользуемых конфигураций, особенно при работе с динамическими параметрами и сложными структурами данных.